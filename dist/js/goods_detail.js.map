{"version":3,"sources":["goods_detail.js"],"names":["$","GoodsObj","init","detailData","eventList","on","userinfo","sessionStorage","getItem","mui","toast","setTimeout","setItem","location","href","token","JSON","parse","ajax","type","url","data","info","stringify","dataType","headers","Authorization","success","res","meta","status","confirm","editType","index","console","log","result","msg","get","goods_id","getUrl","cat_id","goods_name","goods_number","goods_price","goods_small_logo","goods_weight","html","template","gallery","slider","interval","name","reg","RegExp","r","window","search","substr","match","decodeURI"],"mappings":"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","sourcesContent":["$(function () {\r\n    /* \r\n  1 点击 “加入购物车” tap事件\r\n    1 获取本地存储中的一个   userinfo\r\n    2 判断 userinfo 是否为null \r\n      1 null 没有登录过    =>   1 弹出对话框 您还没登录 2 延迟跳转页面 登录页面\r\n    3 登录过了 构造参数 完成 添加到 购物车的功能\r\n  2 准备参数 发送请求完成登录   添加到购物车功能 必须要用到token\r\n    1 准备参数  从第一次获取数据的时候  来获取  \r\n    2 准备发送请求 添加到购物车\r\n    3 在api文档的最开头已经有说明\r\n      1 把token从本地存储中获取出来\r\n      2 把token存放到请求头\r\n           \"Authorization\" : token\r\n  3 加入购物车成功\r\n    1 弹出 确认框 mui消息提示框 \r\n    2 跳转的时候 跳转到购物车页面\r\n    3 取消的时候 就什么都不做\r\n  \r\n   */\r\n\r\n    // 商品信息对象\r\n    let GoodsObj = {};\r\n\r\n    init();\r\n    function init() {\r\n        detailData();\r\n        eventList();\r\n    }\r\n\r\n    // 事件绑定函数\r\n    function eventList() {\r\n        $('.add_car').on('tap', function () {\r\n            // 先获取本地储存的数据，是否有userInfo用户凭证\r\n            let userinfo = sessionStorage.getItem('userinfo');\r\n            if (!userinfo) {\r\n                // 提示未登录\r\n                mui.toast('您还未登录，请您登录')\r\n                setTimeout(() => {\r\n                    // 还需要将此页面的url记住，便于用户登录完成后返回此页面\r\n                    sessionStorage.setItem('pageurl', location.href)\r\n                    location.href = 'login.html'\r\n                }, 1000);\r\n            } else {\r\n                // 需要将数据发送到后台，\r\n                // 带上token不然无效\r\n\r\n                // 取出token\r\n                let token = JSON.parse(userinfo).token;\r\n                // 2.4 把token存入到请求头中\r\n                // 2.4.1 $.post 简洁的ajax的方法 没有办法添加请求头信息，要给ajax添加请求头的时候 必须要使用 $.ajax\r\n                $.ajax({\r\n                    type: \"post\",\r\n                    url: \"http://api.pyg.ak48.xyz/api/public/v1/my/cart/add\",\r\n                    data: {\r\n                        info: JSON.stringify(GoodsObj)\r\n                    },\r\n                    dataType: \"json\",\r\n                    headers: {\r\n                        Authorization: token\r\n                    },\r\n                    success: function (res) {\r\n                        if (res.meta.status == 200) {\r\n                            mui.confirm('您是否需要跳转购物车页面？', '添加成功', ['跳转', '取消'], function (editType) {\r\n                                if (editType.index == 0) {\r\n                                    location.href = \"cart.html\"\r\n                                    // console.log('跳转')\r\n                                } else if (editType.index == 1) {\r\n                                    console.log(\"取消\");\r\n                                }\r\n                            })\r\n                        } else {\r\n                            // 失败\r\n                            mui.toast(result.meta.msg);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    function detailData() {\r\n        $.get(\"http://api.pyg.ak48.xyz/api/public/v1/goods/detail\", { goods_id: getUrl('goods_id') }, function (res) {\r\n            if (res.meta.status == 200) {\r\n                GoodsObj = {\r\n                    cat_id: res.data.cat_id,\r\n                    goods_id: res.data.goods_id,\r\n                    goods_name: res.data.goods_name,\r\n                    goods_number: res.data.goods_number,\r\n                    goods_price: res.data.goods_price,\r\n                    goods_small_logo: res.data.goods_small_logo,\r\n                    goods_weight: res.data.goods_weight\r\n                }\r\n                let data = res.data;\r\n                let html = template('goodDetailTemp', data)\r\n\r\n                $('.pyg_view').html(html)\r\n\r\n                //获得slider插件对象\r\n                var gallery = mui('.mui-slider');\r\n                gallery.slider({\r\n                    interval: 5000//自动轮播周期，若为0则不自动播放，默认为0；\r\n                });\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n\r\n    // 获取页面地址栏?号后带的数据\r\n    function getUrl(name) {\r\n        var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n        var r = window.location.search.substr(1).match(reg);\r\n        if (r != null) return decodeURI(r[2]);\r\n        return null;\r\n    }\r\n})"],"file":"goods_detail.js"}